<!DOCTYPE html>
<html lang="en">

<%- include('partials/head', { pageTitle: `TasteLoop - ${anime.title}` }) %>

<body class="min-h-screen bg-gradient-to-b from-zinc-950 via-zinc-900 to-black text-white">
  <%- include('partials/header') %>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <% if (!anime) { %>
    <div class="p-6 rounded-xl bg-white/5 border border-white/10">
      <h1 class="text-2xl font-semibold mb-2">Anime not found</h1>
      <p class="text-white/70">We couldn't locate this title. It may be missing from the dataset.</p>
      <div class="mt-4">
        <a href="/" class="inline-flex items-center px-3 py-1.5 rounded-md bg-yellow-500 text-black font-medium hover:bg-yellow-400">Back to home</a>
      </div>
    </div>
    <% } else { %>
    <section class="mb-8">
      <div class="flex items-start gap-6">
        <img class="w-32 h-44 object-cover rounded-lg border border-white/10" src="<%= anime.images.jpg.large_image_url %>" alt="<%= anime.title %> poster">
        <div class="flex-1">
          <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight"><%= anime.title %></h1>
          <p class="text-white/70"><%= anime.title_japanese || '' %></p>
          <div class="mt-3 flex flex-wrap items-center gap-3 text-sm text-white/70">
            <span class="px-2 py-0.5 rounded bg-white/5 border border-white/10"><%= anime.type %></span>
            <span><%= anime.year ?? '-' %></span>
            <span>‚≠ê <%= anime.score %> ¬∑ <%= anime.favorites.toLocaleString('en-US') %> favorites</span>
            <span>üëÅÔ∏è <%= anime.members.toLocaleString('en-US') %> members</span>
          </div>
          <% if (anime.genres?.length) { %>
          <div class="mt-3 flex flex-wrap gap-2">
            <% anime.genres.slice(0,6).forEach(g => { %>
            <span class="text-xs px-2 py-0.5 rounded-full bg-white/5 border border-white/10 text-white/80"><%= g.name %></span>
            <% }) %>
          </div>
          <% } %>
          <% if (anime.synopsis) { %>
          <p class="mt-4 text-sm text-white/80 leading-relaxed line-clamp-[8]"><%= anime.synopsis %></p>
          <% } %>
        </div>
      </div>
    </section>

    <section class="grid md:grid-cols-2 gap-6">
      <div>
        <h2 class="text-xl mb-3 font-semibold text-yellow-400">Openings</h2>
        <div class="space-y-3">
          <% anime.themes.openings.forEach(opening => { const parsed = structuredTheme(opening); if (!parsed) return; %>
          <article class="flex items-center justify-between gap-4 p-3 rounded-lg bg-white/5 border border-white/10">
            <div class="flex items-center gap-4 min-w-0">
              <span class="text-yellow-400 font-extrabold text-lg shrink-0"><%= parsed.prefix ?? '' %></span>
              <div class="min-w-0">
                <h3 class="font-semibold truncate"><%= parsed.title %></h3>
                <p class="text-sm text-white/70 truncate"><%= parsed.artist %></p>
              </div>
            </div>
            <a class="shrink-0 inline-flex items-center gap-1 px-3 py-1.5 rounded-md bg-yellow-500 text-black font-medium hover:bg-yellow-400" href="/anime/<%= anime.mal_id %>/opening/<%= parsed.prefix %>">Play</a>
          </article>
          <% }) %>
        </div>
      </div>
      <div>
        <h2 class="text-xl mb-3 font-semibold">Endings</h2>
        <div class="space-y-3">
          <% anime.themes.endings.forEach(ending => { const parsed = structuredTheme(ending); if (!parsed) return; %>
          <article class="flex items-center justify-between gap-4 p-3 rounded-lg bg-white/5 border border-white/10">
            <div class="flex items-center gap-4 min-w-0">
              <span class="text-yellow-400 font-extrabold text-lg shrink-0"><%= parsed.prefix ?? '' %></span>
              <div class="min-w-0">
                <h3 class="font-semibold truncate"><%= parsed.title %></h3>
                <p class="text-sm text-white/70 truncate"><%= parsed.artist %></p>
              </div>
            </div>
            <a class="shrink-0 inline-flex items-center gap-1 px-3 py-1.5 rounded-md bg-yellow-500 text-black font-medium hover:bg-yellow-400" href="/anime/<%= anime.mal_id %>/ending/<%= parsed.prefix %>">Play</a>
          </article>
          <% }) %>
        </div>
      </div>
    </section>
    <% } %>
  </main>

  <%- include('partials/footer') %>
</body>

</html>